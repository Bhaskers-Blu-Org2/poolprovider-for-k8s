# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

variables:
  poolname: '$(Build.BuildId)'
  URI: 'https://dev.azure.com/bansalpreeti1'
  projectname: 'test2'
  sharedSecret: 'sharedsecret1234'
  targetSize: '1'

stages:
- stage: Deploy_Pool_Provider_Agent
  jobs:

  ################################################################################
  - job: Configure_poolprovider
  ################################################################################
    pool:
      vmImage: 'ubuntu-latest'

    steps:
      - task: HelmInstaller@1
        inputs:
          helmVersionToInstall: '2.15.0-rc.1'
      - task: HelmDeploy@0
        displayName: 'helm init'
        inputs:
          connectionType: 'Azure Resource Manager'
          azureSubscription: 'RMDev (c00d16c7-6c1f-4c03-9be1-6934a4c49682)'
          azureResourceGroup: 'processmonitor-rg'
          kubernetesCluster: 'testpool2'
          command: 'init'
          arguments: '--service-account tiller'